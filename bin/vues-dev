#!/usr/bin/env node

const cli   = require('commander')
const chalk = require('chalk')
const serve = require('micro')

const defaultHost = 'localhost'
const defaultPort = 3000

cli.option('-h, --host [host]', `Server host ${chalk.blue(`(${defaultHost})`)}`, defaultHost)
   .option('-p, --port [port]', `Server port ${chalk.blue(`(${defaultPort})`)}`, defaultPort)
   .parse(process.argv)

require('babel-register')({
  presets: ['es2015', 'es2016', 'es2017'],
  only: /vues\/lib\/.*.js$/
})

const server = require('../lib/server').default
const config = {
  host: cli.host,
  port: cli.port
}

const { host, port } = config

serve(server(config)).listen(port, host, err => {
  if (err) {
    console.error('micro:', err.stack) // eslint-disable-line no-console
    process.exit(1)
  }
  console.log(`> Ready! Listening on http://${host}:${port}`) // eslint-disable-line no-console
})
